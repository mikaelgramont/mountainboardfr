var Lib=Lib||{};Lib.FacebookUpload={token:null,userId:null,photos:[],defaultOptions:{pageTitle:"post a photo from Facebook",loading:"loading...",albumSingular:"album",albumPlural:"albums",pickAFacebookAlbum:"pick an album",pickAnotherOne:"pick another one",photoSingular:"photo",photoPlural:"photos",imgPath:"/images/default/"},options:{},ucfirst:function(b){b+="";var a=b.charAt(0).toUpperCase();return a+b.substr(1)},start:function(a){this.token=this.getAccessToken();if(this.token==null){return}this.options=jQuery.extend(this.defaultOptions,a);this.loadUser()},getAccessToken:function(){var a=null;if(window.location.hash.length>0){a=window.location.hash.substring(1)}return a},replaceFileInput:function(){$("#mediaHint").remove();$("#media").parent().prepend('			<div id="facebookPhotoExplorer">				<div class="loading">					<img src="/'+this.options.imgPath+'ajax-loader.gif" alt="" />					'+this.ucfirst(this.options.loading)+'				</div>				<div class="albums">					<p>'+this.ucfirst(this.options.pickAFacebookAlbum)+'</p>					<ul/>				</div>				<div class="photos">					<span class="albumTitle"></span>					<a href="#" class="back">('+this.options.pickAnotherOne+")</a>					<ul/>				</div>			</div>			").end().replaceWith('			<input type="text" id="media" name="media" readonly="readonly">			<input type="hidden" id="useRemoteFile" name="useRemoteFile" value="1">')},setUpClickHandlers:function(){var a=this;$("#facebookPhotoExplorer div.photos").click(function(b){$("#media").val(b.target.parentNode.rel);$(this).find("li").removeClass("selected");$(b.target.parentNode.parentNode).addClass("selected");return false});$("#facebookPhotoExplorer div.albums").click(function(c){var b=c.target.rel.split("|");a.getAlbumPhotos(c.target.text,b[0],b[1]);return false});$("#facebookPhotoExplorer div.photos a.back").click(function(){$("#facebookPhotoExplorer div.albums").show();$("#facebookPhotoExplorer div.photos").hide();$("#facebookPhotoExplorer div.photos ul").empty();return false})},loadScript:function(a,c){var b=document.createElement("script");b.type="text/javascript";if(typeof(c)!="undefined"){a+="&callback="+c}b.src=a;document.getElementsByTagName("head")[0].appendChild(b);$("#facebookPhotoExplorer div.albums, #facebookPhotoExplorer div.photos").hide();$("#facebookPhotoExplorer div.loading").show()},loadUser:function(){this.loadScript("https://graph.facebook.com/me?"+this.token,"Lib.FacebookUpload.proceed")},proceed:function(a){if(typeof(a.id)=="undefined"){alert("unauthorized");return}this.userId=a.id;$("div.addPhotoFacebook").remove();this.changeTitle();this.replaceFileInput();this.setUpClickHandlers();this.getAlbums()},changeTitle:function(){$("h1.albumTitle").text(this.ucfirst(this.options.pageTitle))},getAlbums:function(a){this.loadScript("https://graph.facebook.com/"+this.userId+"/albums/?"+this.token,"Lib.FacebookUpload.listAlbums")},listAlbums:function(e){this.albums=e.data;var h=document.createDocumentFragment();for(var f=0,c=this.albums.length;f<c;f++){if(typeof(this.albums[f].count)=="undefined"){continue}var b=document.createElement("li"),d=document.createElement("a"),g=document.createElement("span");g.className="count";g.appendChild(document.createTextNode(" ("+this.albums[f].count+" "+((this.albums[f].count>1)?this.options.photoPlural:this.options.photoSingular)+")"));d.appendChild(document.createTextNode(this.albums[f].name));d.href="#";d.rel=this.albums[f].id+"|"+this.albums[f].count+"|"+this.albums[f].link;d.className="album dataLink";b.appendChild(d);b.appendChild(g);h.appendChild(b)}$("#facebookPhotoExplorer div.loading").hide();$("#facebookPhotoExplorer div.albums ul").empty().get(0).appendChild(h);$("#facebookPhotoExplorer div.albums").show()},getAlbumPhotos:function(c,a,b){$("#facebookPhotoExplorer div.photos span.albumTitle").text(this.ucfirst(this.options.albumSingular)+": "+c);this.loadScript("https://graph.facebook.com/"+a+"/photos/?"+this.token+"&limit="+b,"Lib.FacebookUpload.showPhotos")},getUserPhotos:function(a){this.userId=a.id;this.loadScript("https://graph.facebook.com/"+this.userId+"/photos/?"+this.token,"Lib.FacebookUpload.showPhotos")},showPhotos:function(f){$("#facebookPhotoExplorer div.albums").hide();$("#facebookPhotoExplorer div.photos").show();this.photos=f.data;var j=document.createDocumentFragment();for(var h=0,c=this.photos.length;h<c;h++){var g=this.photos[h],b=document.createElement("li"),d=document.createElement("a"),e=document.createElement("img");d.href="#";d.rel=g.images[0].source;e.src=g.picture;d.appendChild(e);b.appendChild(d);j.appendChild(b)}$("#facebookPhotoExplorer div.loading").hide();$("#facebookPhotoExplorer div.photos ul").empty().show().get(0).appendChild(j)}};